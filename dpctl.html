<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-554F8VNE28"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-554F8VNE28');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interplay with the Data Parallel Control Library &mdash; Data Parallel Extension for NumPy 0.13.1dev3+28.g19b742e218 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=6d10936d"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Data Parallel Extension for NumPy
          </a>
              <div class="version">
                0.13.1dev3+28.g19b742e218
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_start_guide.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference/index.html">API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dpnp_backend_api.html">C++ backend API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Data Parallel Extension for NumPy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Interplay with the Data Parallel Control Library</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/dpctl.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <span class="target" id="dptcl"></span><section id="interplay-with-the-data-parallel-control-library">
<h1>Interplay with the Data Parallel Control Library<a class="headerlink" href="#interplay-with-the-data-parallel-control-library" title="Link to this heading"></a></h1>
<p><a class="reference external" href="https://intelpython.github.io/dpctl/latest/index.html">Data Parallel Control Library</a> provides API to manage specific
<a class="reference external" href="https://www.khronos.org/sycl/">SYCL*</a> resources for SYCL-based Python packages.</p>
<p>An example below demonstrates how the Data Parallel Extension for NumPy* can be
easily combined with the device management interface provided by dpctl package.</p>
<p>Literally, the SYCL* queue manager interface from the dpctl package allows
to set an input queue as the currently usable queue inside the context
manager’s scope. This way an array creation function from the dpnp package
which is defined inside the context will allocate the data using that queue.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">import</span> <span class="nn">dpctl</span>
<span class="linenos">2</span><span class="kn">import</span> <span class="nn">dpnp</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos">3</span>
<span class="linenos">4</span><span class="k">with</span> <span class="n">dpctl</span><span class="o">.</span><span class="n">device_context</span><span class="p">(</span><span class="s2">&quot;opencl:gpu&quot;</span><span class="p">):</span>
<span class="linenos">5</span>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="linenos">6</span>    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>For more information please refer to <a class="reference external" href="https://intelpython.github.io/dpctl/latest/index.html">Data Parallel Control Library</a>
documentation.</p>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">time</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="kn">import</span> <span class="nn">dpnp</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">executor</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">test_type</span><span class="p">,</span> <span class="n">repetition</span><span class="p">):</span>
<span class="linenos"> 9</span>    <span class="n">x</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
<span class="linenos">10</span>        <span class="n">executor</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">size</span> <span class="o">*</span> <span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">test_type</span><span class="p">),</span> <span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
<span class="linenos">11</span>    <span class="p">)</span>
<span class="linenos">12</span>
<span class="linenos">13</span>    <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">14</span>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repetition</span><span class="p">):</span>
<span class="linenos">15</span>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="linenos">16</span>        <span class="n">result</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="linenos">17</span>        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="linenos">18</span>        <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
<span class="linenos">19</span>
<span class="linenos">20</span>    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">times</span><span class="p">),</span> <span class="n">result</span>
<span class="linenos">21</span>
<span class="linenos">22</span>
<span class="linenos">23</span><span class="k">def</span> <span class="nf">get_dtypes</span><span class="p">():</span>
<span class="linenos">24</span>    <span class="n">_dtypes_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">]</span>
<span class="linenos">25</span>    <span class="n">device</span> <span class="o">=</span> <span class="n">dpctl</span><span class="o">.</span><span class="n">select_default_device</span><span class="p">()</span>
<span class="linenos">26</span>    <span class="k">if</span> <span class="n">device</span><span class="o">.</span><span class="n">has_aspect_fp64</span><span class="p">:</span>
<span class="linenos">27</span>        <span class="n">_dtypes_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="linenos">28</span>    <span class="k">return</span> <span class="n">_dtypes_list</span>
<span class="linenos">29</span>
<span class="linenos">30</span>
<span class="linenos">31</span><span class="k">def</span> <span class="nf">example</span><span class="p">():</span>
<span class="linenos">32</span>    <span class="n">test_repetition</span> <span class="o">=</span> <span class="mi">5</span>
<span class="linenos">33</span>    <span class="k">for</span> <span class="n">test_type</span> <span class="ow">in</span> <span class="n">get_dtypes</span><span class="p">():</span>
<span class="linenos">34</span>        <span class="n">type_name</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">test_type</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
<span class="linenos">35</span>        <span class="nb">print</span><span class="p">(</span>
<span class="linenos">36</span>            <span class="sa">f</span><span class="s2">&quot;...Test data type is </span><span class="si">{</span><span class="n">type_name</span><span class="si">}</span><span class="s2">, each test repetitions </span><span class="si">{</span><span class="n">test_repetition</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="linenos">37</span>        <span class="p">)</span>
<span class="linenos">38</span>
<span class="linenos">39</span>        <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="mi">4096</span><span class="p">]:</span>
<span class="linenos">40</span>            <span class="n">time_numpy</span><span class="p">,</span> <span class="n">result_numpy</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span>
<span class="linenos">41</span>                <span class="n">numpy</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">test_type</span><span class="p">,</span> <span class="n">test_repetition</span>
<span class="linenos">42</span>            <span class="p">)</span>
<span class="linenos">43</span>            <span class="n">time_dpnp</span><span class="p">,</span> <span class="n">result_dpnp</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">dpnp</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">test_type</span><span class="p">,</span> <span class="n">test_repetition</span><span class="p">)</span>
<span class="linenos">44</span>
<span class="linenos">45</span>            <span class="k">if</span> <span class="n">result_dpnp</span> <span class="o">==</span> <span class="n">result_numpy</span><span class="p">:</span>
<span class="linenos">46</span>                <span class="n">verification</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">47</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">48</span>                <span class="n">verification</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">result_dpnp</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">result_numpy</span><span class="si">}</span><span class="s2">)&quot;</span>
<span class="linenos">49</span>
<span class="linenos">50</span>            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;type:</span><span class="si">{</span><span class="n">type_name</span><span class="si">}</span><span class="s2">:N:</span><span class="si">{</span><span class="n">size</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2">:NumPy:</span><span class="si">{</span><span class="n">time_numpy</span><span class="si">:</span><span class="s2">.3e</span><span class="si">}</span><span class="s2">:DPNP:</span><span class="si">{</span><span class="n">time_dpnp</span><span class="si">:</span><span class="s2">.3e</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="linenos">51</span>            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;:ratio:</span><span class="si">{</span><span class="n">time_numpy</span><span class="o">/</span><span class="n">time_dpnp</span><span class="si">:</span><span class="s2">6.2f</span><span class="si">}</span><span class="s2">:verification:</span><span class="si">{</span><span class="n">verification</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="linenos">52</span>            <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="linenos">53</span>
<span class="linenos">54</span>
<span class="linenos">55</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">56</span>    <span class="k">try</span><span class="p">:</span>
<span class="linenos">57</span>        <span class="kn">import</span> <span class="nn">dpctl</span>
<span class="linenos">58</span>
<span class="linenos">59</span>        <span class="k">with</span> <span class="n">dpctl</span><span class="o">.</span><span class="n">device_context</span><span class="p">(</span><span class="s2">&quot;opencl:gpu&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">gpu_queue</span><span class="p">:</span>
<span class="linenos">60</span>            <span class="n">gpu_queue</span><span class="o">.</span><span class="n">get_sycl_device</span><span class="p">()</span><span class="o">.</span><span class="n">print_device_info</span><span class="p">()</span>
<span class="linenos">61</span>            <span class="n">example</span><span class="p">()</span>
<span class="linenos">62</span>
<span class="linenos">63</span>    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<span class="linenos">64</span>        <span class="n">example</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2024, Intel Corporation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>